â€¢

Maintenance: Entering an iteration of the for loop, the top point on stack S is pi-1,
which was pushed at the end of the previous iteration (or before the first iteration,
when i = 3). Let pj be the top point on S after the while loop of lines 7-8 is executed
but before line 9 pushes pi, and let pk be the point just below pj on S. At the moment
that pj is the top point on S and we have not yet pushed pi, stack S contains exactly the
same points it contained after iteration j of the for loop. By the loop invariant,
therefore, S contains exactly the vertices of CH(Qj) at that moment, and they appear in
counterclockwise order from bottom to top.
Let us continue to focus on this moment just before pi is pushed. Referring to Figure
33.8(a), because pi's polar angle relative to p0 is greater than pj's polar angle, and
because the angle pkpjpi makes a left turn (otherwise we would have popped pj ), we
see that since S contains exactly the vertices of CH(Qj), once we push pi , stack S will
contain exactly the vertices of CH(Qj {pi}), still in counterclockwise order from
bottom to top.

Figure 33.8: The proof of correctness of GRAHAM-SCAN. (a) Because pi's polar
angle relative to p0 is greater than pj's polar angle, and because the angle pkpj pi
makes a left turn, adding pi to CH(Qj) gives exactly the vertices of CH(Qj {pi}). (b)
If the angle prptpi makes a nonleft turn, then pt is either in the interior of the triangle
formed by p0, pr, and pi or on a side of the triangle, and it cannot be a vertex of
CH(Qi).
We now show that CH(Qj {pi}) is the same set of points as CH(Qi). Consider any
point pt that was popped during iteration i of the for loop, and let pr be the point just
below pt on stack S at the time pt was popped (pr might be pj ). The angle prptpi
makes a nonleft turn, and the polar angle of pt relative to p0 is greater than the polar
angle of pr. As Figure 33.8(b) shows, pt must be either in the interior of the triangle
formed by p0, pr, and pi or on a side of this triangle (but it is not a vertex of the
triangle). Clearly, since pt is within a triangle formed by three other points of Qi, it
cannot be a vertex of CH(Qi). Since pt is not a vertex of CH(Qi), we have that
(33.1)
Let Pi be the set of points that were popped during iteration i of the for loop. Since the
equality (33.1) applies for all points in Pi, we can apply it repeatedly to show that
CH(Qi - Pi) = CH(Qi). But Qi - Pi = Qj {pi}, and so we conclude that CH(Qj {pi})
= CH(Qi - Pi) = CH(Qi).
We have shown that once we push pi , stack S contains exactly the vertices of CH(Qi)
in counterclockwise order from bottom to top. Incrementing i will then cause the loop
invariant to hold for the next iteration.

